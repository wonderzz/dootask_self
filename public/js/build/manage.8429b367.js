import{n as r,N as O,m as d,c as g,d as c}from"./app.af42c865.js";import{C as z,T as F}from"./CheckinExport.255c15be.js";import{D as B}from"./index.d59d6da9.js";import W from"./TEditor.86d491ee.js";import{U as v}from"./UserSelect.aa594679.js";import{R as H}from"./ReportEdit.a683bda5.js";import{R as V}from"./ReportDetail.3eadc7e5.js";import{l as K}from"./longpress.43ca7fd9.js";import{D as Y}from"./DialogWrapper.f6b8ea4e.js";import{T as J}from"./TaskDetail.da1213f6.js";import"./ImgUpload.91c68df8.js";import"./details.f79891d6.js";import"./ProjectLog.16e4d6c3.js";import"./TaskMenu.94327b97.js";var q=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"project-archived"},[e("div",{staticClass:"archived-title"},[t._v(" "+t._s(t.$L("\u5F52\u6863\u7684\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(s){t.$set(t.keys,"name",s)},expression:"keys.name"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},G=[];const X={name:"ProjectArchived",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:a,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",a.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:200,render:(t,{row:a})=>t("AutoTip",a.name)},{title:this.$L("\u5F52\u6863\u65F6\u95F4"),key:"archived_at",width:168},{title:this.$L("\u5F52\u6863\u4EBA\u5458"),key:"archived_userid",minWidth:80,render:(t,{row:a})=>a.archived_userid?t("UserAvatar",{props:{userid:a.archived_userid,size:24,showName:!0}}):t("Tag",this.$L("\u7CFB\u7EDF\u81EA\u52A8"))},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.owner_userid}})},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(t,a)=>{const e=[t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u8FD8\u539F\u5F52\u6863\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.recovery(a.row)}}},this.$L("\u8FD8\u539F")),t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u9879\u76EE\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:"8px",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(a.row)}}},this.$L("\u5220\u9664"))];return t("TableAction",{props:{column:a.column}},e)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,archived:"yes",page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},recovery(t){this.list=this.list.filter(({id:a})=>a!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"project/archived",data:{project_id:t.id,type:"recovery"}}).then(()=>{this.getLists(),this.$store.dispatch("getProjectOne",t.id).catch(()=>{})}).catch(({msg:a})=>{$A.modalError(a),this.getLists()}).finally(a=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:a})=>a!=t.id),this.loadIng++,this.$store.dispatch("removeProject",t.id).then(({msg:a})=>{$A.messageSuccess(a),this.getLists()}).catch(({msg:a})=>{$A.modalError(a),this.getLists()}).finally(a=>{this.loadIng--})}}},k={};var Q=r(X,q,G,!1,Z,null,null,null);function Z(t){for(let a in k)this[a]=k[a]}var tt=function(){return Q.exports}(),et=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"project-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u6240\u6709\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(s){t.$set(t.keys,"name",s)},expression:"keys.name"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u56E2\u961F\u9879\u76EE")},model:{value:t.keys.type,callback:function(s){t.$set(t.keys,"type",s)},expression:"keys.type"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u56E2\u961F\u9879\u76EE")))]),e("Option",{attrs:{value:"personal"}},[t._v(t._s(t.$L("\u4E2A\u4EBA\u9879\u76EE")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8\u9879\u76EE")))])],1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u672A\u5F52\u6863")},model:{value:t.keys.status,callback:function(s){t.$set(t.keys,"status",s)},expression:"keys.status"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u672A\u5F52\u6863")))]),e("Option",{attrs:{value:"archived"}},[t._v(t._s(t.$L("\u5DF2\u5F52\u6863")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},at=[];const st={name:"ProjectManagement",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:a,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",a.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:100,render:(t,{row:a})=>{const e=[t("AutoTip",a.name)];return a.archived_at&&e.push(t("Tag",{props:{color:"error"}},this.$L("\u5DF2\u5F52\u6863"))),t("div",{class:"project-name"},e)}},{title:this.$L("\u9879\u76EE\u8FDB\u5EA6"),minWidth:100,render:(t,{row:a})=>{const e=[t("AutoTip",a.task_complete+"/"+a.task_num),t("Progress",{props:{percent:a.task_percent,strokeWidth:5}})];return t("div",{class:"project-percent"},e)}},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.owner_userid}})},{title:this.$L("\u521B\u5EFA\u4EBA"),minWidth:80,render:(t,{row:a})=>t("UserAvatar",{props:{showName:!0,size:22,userid:a.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){let t="team";this.keys.type=="all"?t="all":this.keys.type=="personal"&&(t="personal");let a="no";this.keys.status=="all"?a="all":this.keys.status=="archived"&&(a="yes"),this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,all:1,archived:a,type:t,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:e})=>{this.page=e.current_page,this.total=e.total,this.list=e.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(e=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()}}},y={};var it=r(st,et,at,!1,ot,null,null,null);function ot(t){for(let a in y)this[a]=y[a]}var rt=function(){return it.exports}(),nt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mobile-tabbar"},[t.windowPortrait?e("NetworkException",{attrs:{type:"alert"}}):t._e(),e("transition",{attrs:{name:"mobile-fade"}},[t.isMore?e("div",{staticClass:"more-mask",on:{click:function(s){return t.toggleRoute("more")}}}):t._e()]),e("transition",{attrs:{name:"mobile-slide"}},[t.isMore?e("div",{staticClass:"more-box"},[e("div",{staticClass:"tabbar-more-title"},[t._v(t._s(t.$L("\u66F4\u591A")))]),t._l(t.navMore,function(s){return e("ul",t._l(s,function(i){return e("li",{class:{active:t.activeName===i.name},on:{click:function(o){return t.toggleRoute(i.name)}}},[e("div",{staticClass:"more-item"},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(i.icon)}}),e("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(i.label)))]),i.name==="workReport"?e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber}}):t._e()],1)])}),0)})],2):t._e()]),e("ul",{staticClass:"tabbar-box"},t._l(t.navList,function(s){return e("li",{class:{active:t.activeName===s.name},on:{click:function(i){return t.toggleRoute(s.name)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(s.icon)}}),e("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(s.label)))]),s.name==="dashboard"?[t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.all_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.all_count}}):t._e()]:s.name==="dialog"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})]:s.name==="more"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber}})]:t._e()],2)}),0),e("Modal",{attrs:{title:t.$L("\u626B\u7801\u767B\u5F55"),"mask-closable":!1},model:{value:t.scanLoginShow,callback:function(s){t.scanLoginShow=s},expression:"scanLoginShow"}},[e("div",{staticClass:"mobile-scan-login-box"},[e("div",{staticClass:"mobile-scan-login-title"},[t._v(t._s(t.$L("\u4F60\u597D\uFF0C\u626B\u7801\u786E\u8BA4\u767B\u5F55")))]),e("div",{staticClass:"mobile-scan-login-subtitle"},[t._v("\u300C"+t._s(t.$L("\u4E3A\u786E\u4FDD\u5E10\u53F7\u5B89\u5168\uFF0C\u8BF7\u786E\u8BA4\u662F\u672C\u4EBA\u64CD\u4F5C"))+"\u300D")])]),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.scanLoginShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u767B\u5F55")))]),e("Button",{attrs:{type:"primary",loading:t.scanLoginLoad},on:{click:t.scanLoginSubmit}},[t._v(t._s(t.$L("\u786E\u8BA4\u767B\u5F55")))])],1)])],1)},lt=[];const ct={name:"MobileTabbar",components:{NetworkException:O},data(){return{isMore:!1,navList:[{icon:"&#xe6fb;",name:"dashboard",label:"\u4EEA\u8868\u76D8"},{icon:"&#xe6fa;",name:"project",label:"\u9879\u76EE"},{icon:"&#xe6eb;",name:"dialog",label:"\u6D88\u606F"},{icon:"&#xe6b2;",name:"contacts",label:"\u901A\u8BAF\u5F55"},{icon:"&#xe6e9;",name:"more",label:"\u66F4\u591A"}],navMore:[[{icon:"&#xe6f5;",name:"calendar",label:"\u65E5\u5386"},{icon:"&#xe6f3;",name:"file",label:"\u6587\u4EF6"},{icon:"&#xe67b;",name:"setting",label:"\u8BBE\u7F6E"}],[{icon:"&#xe7b9;",name:"addProject",label:"\u521B\u5EFA\u9879\u76EE"},{icon:"&#xe7b8;",name:"addTask",label:"\u6DFB\u52A0\u4EFB\u52A1"},{icon:"&#xe7c1;",name:"createMeeting",label:"\u65B0\u4F1A\u8BAE"},{icon:"&#xe794;",name:"joinMeeting",label:"\u52A0\u5165\u4F1A\u8BAE"}],[{icon:"&#xe7da;",name:"workReport",label:"\u5DE5\u4F5C\u62A5\u544A"},{icon:"&#xe7b9;",name:"approve",label:"\u5BA1\u6279\u4E2D\u5FC3"}]],scanLoginShow:!1,scanLoginLoad:!1,scanLoginCode:""}},created(){$A.isEEUiApp&&this.navMore[0].splice(2,0,{icon:"&#xe602;",name:"scan",label:"\u626B\u4E00\u626B"}),this.userIsAdmin&&this.navMore[2].splice(0,0,{icon:"&#xe63f;",name:"allUser",label:"\u56E2\u961F\u7BA1\u7406"})},mounted(){},beforeDestroy(){},computed:{...d(["userIsAdmin","cacheDialogs","reportUnreadNumber"]),...g(["dashboardTask"]),routeName(){return this.$route.name},msgUnreadMention(){let t=0,a=0;this.cacheDialogs.some(s=>{t+=$A.getDialogUnread(s,!1),a+=$A.getDialogMention(s)}),t>999&&(t="999+"),a>999&&(a="999+");const e=this.msgTodoTotal;return e?a?`@${a}\xB7${e}`:t?`${t}\xB7${e}`:e:t?a?`${t}\xB7@${a}`:String(t):a?`@${a}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(a=>{t+=$A.getDialogNum(a)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((a,e)=>a+(e.todo_num||0),0);return t>0?(t>999?t="999+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},activeName(){return this.isMore||["manage-calendar","manage-file","manage-setting"].includes(this.routeName)?"more":this.routeName==="manage-dashboard"?"dashboard":this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?"project":this.routeName==="manage-messenger"?this.$route.params.dialogAction==="contacts"?"contacts":"dialog":""}},watch:{windowActive(t){t||$A.eeuiAppSendMessage({action:"setBdageNotify",bdage:this.unreadAndOverdue})}},methods:{toggleRoute(t){this.$emit("on-click",t),t!="more"&&(this.isMore=!1);let a;switch(t){case"more":this.isMore=!this.isMore;return;case"scan":$A.eeuiAppScan(this.scanResult);return;case"addTask":case"addProject":case"allUser":case"workReport":return;case"createMeeting":c.Store.set("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":c.Store.set("addMeeting",{type:"join"});break;case"project":a={name:"manage-project",params:{projectId:"all"}};break;case"dialog":a={name:"manage-messenger",params:{dialogAction:"dialog"}},this.routeName==="manage-messenger"&&c.Store.set("clickAgainDialog",!0);break;case"contacts":a={name:"manage-messenger",params:{dialogAction:"contacts"}};break;default:a={name:"manage-"+t};break}this.goForward(a)},scanResult(t){const a=(t+"").match(/^https*:\/\/(.*?)\/login\?qrcode=(.*?)$/);if(a){this.scanLoginCode=a[2],this.scanLoginShow=!0;return}/^https*:\/\//i.test(t)&&$A.eeuiAppOpenPage({pageType:"app",pageTitle:" ",url:"web.js",params:{url:t,browser:!0,showProgress:!0}})},scanLoginSubmit(){this.scanLoginLoad!==!0&&(this.scanLoginLoad=!0,this.$store.dispatch("call",{url:"users/login/qrcode",data:{type:"login",code:this.scanLoginCode}}).then(({msg:t})=>{this.scanLoginShow=!1,$A.messageSuccess(t)}).catch(({msg:t})=>{$A.messageError(t)}).finally(t=>{this.scanLoginLoad=!1}))}}},w={};var dt=r(ct,nt,lt,!1,ht,null,null,null);function ht(t){for(let a in w)this[a]=w[a]}var ut=function(){return dt.exports}(),pt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"task-add"},[e("div",{staticClass:"head",class:{empty:t.addData.cascader.length==0,visible:t.cascaderShow}},[e("Cascader",{attrs:{data:t.cascaderData,clearable:!1,placeholder:t.$L("\u8BF7\u9009\u62E9\u9879\u76EE"),"load-data":t.cascaderLoadData,filterable:""},on:{"on-change":t.cascaderChange,"on-input-change":t.cascaderInputChange,"on-visible-change":function(s){t.cascaderShow=!t.cascaderShow}},model:{value:t.addData.cascader,callback:function(s){t.$set(t.addData,"cascader",s)},expression:"addData.cascader"}})],1),e("div",{staticClass:"task-add-form"},[e("div",{staticClass:"title"},[e("Input",{ref:"input",attrs:{type:"textarea",rows:1,autosize:{minRows:1,maxRows:8},maxlength:255,placeholder:t.$L("\u4EFB\u52A1\u63CF\u8FF0"),enterkeyhint:"done"},on:{"on-keydown":t.onKeydown},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1),e("div",{staticClass:"desc"},[e("TEditor",{attrs:{plugins:t.taskPlugins,options:t.taskOptions,"option-full":t.taskOptionFull,placeholder:t.$L(t.windowLandscape?"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B...\uFF08\u70B9\u51FB\u53F3\u952E\u4F7F\u7528\u5DE5\u5177\u680F\uFF09":"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B..."),placeholderFull:t.$L("\u8BE6\u7EC6\u63CF\u8FF0..."),inline:""},model:{value:t.addData.content,callback:function(s){t.$set(t.addData,"content",s)},expression:"addData.content"}})],1),e("div",{staticClass:"advanced-option"},[e("Button",{class:{advanced:t.advanced},on:{click:function(s){t.advanced=!t.advanced}}},[t._v(t._s(t.$L("\u9AD8\u7EA7\u9009\u9879")))]),e("ul",{staticClass:"advanced-priority"},t._l(t.taskPriority,function(s,i){return e("li",{key:i},[e("ETooltip",{attrs:{disabled:t.$isEEUiApp||t.windowTouch,content:t.taskPriorityContent(s)}},[e("i",{staticClass:"taskfont",style:{color:s.color},domProps:{innerHTML:t._s(t.addData.p_name==s.name?"&#xe61d;":"&#xe61c;")},on:{click:function(o){return t.choosePriority(s)}}})])],1)}),0),t.taskDays>0?e("DatePicker",{attrs:{open:t.taskTimeOpen,options:t.timeOptions,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange",placement:"bottom"},on:{"on-change":function(s){return t.taskTimeChange(t.addData.times)},"on-open-change":t.taskTimeOpenChange},model:{value:t.addData.times,callback:function(s){t.$set(t.addData,"times",s)},expression:"addData.times"}},[e("div",{staticClass:"advanced-time",on:{click:function(s){return t.taskTimeOpenChange(!t.taskTimeOpen)}}},[e("Icon",{attrs:{type:"ios-clock-outline"}}),e("em",{style:t.addData.p_color?{backgroundColor:t.addData.p_color}:{},attrs:{type:"primary"}},[t._v(t._s(t.taskDays))])],1)]):t._e()],1)]),t.advanced?e("Form",{staticClass:"task-add-advanced",attrs:{"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u8BA1\u5212\u65F6\u95F4")}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(s){return t.taskTimeChange(t.addData.times)}},model:{value:t.addData.times,callback:function(s){t.$set(t.addData,"times",s)},expression:"addData.times"}})],1),e("FormItem",{attrs:{label:t.$L("\u4EFB\u52A1\u8D1F\u8D23\u4EBA")}},[e("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:t.addData.owner,callback:function(s){t.$set(t.addData,"owner",s)},expression:"addData.owner"}}),t.showAddAssist?e("div",{staticClass:"task-add-assist"},[e("Checkbox",{attrs:{"true-value":1,"false-value":0},model:{value:t.addData.add_assist,callback:function(s){t.$set(t.addData,"add_assist",s)},expression:"addData.add_assist"}},[t._v(t._s(t.$L("\u52A0\u5165\u4EFB\u52A1\u534F\u52A9\u4EBA\u5458\u5217\u8868")))]),e("ETooltip",{attrs:{disabled:t.$isEEUiApp||t.windowTouch,content:t.$L("\u4F60\u4E0D\u662F\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u65F6\u5EFA\u8BAE\u52A0\u5165\u4EFB\u52A1\u534F\u52A9\u4EBA\u5458\u5217\u8868")}},[e("Icon",{attrs:{type:"ios-alert-outline"}})],1)],1):t._e()],1),e("FormItem",[e("div",{attrs:{slot:"label"},slot:"label"},[e("EDropdown",{ref:"eDropdownRef",attrs:{trigger:"click",placement:"bottom"},on:{command:t.dropVisible}},[e("span",{staticClass:"visibility-text"},[t._v(t._s(t.$L("\u53EF\u89C1\u6027"))+" "),e("i",{staticClass:"taskfont"},[t._v("\uE740")])]),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("EDropdownItem",{attrs:{command:1}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==1?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u9879\u76EE\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:2}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==2?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:3}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==3?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u6307\u5B9A\u6210\u5458"))+" ")],1)])],1)],1)],1),t.addData.visibility_appoint<3?e("div",{staticClass:"ivu-input task-add-visibility",on:{click:t.showCisibleDropdown}},[t.addData.visibility_appoint==1?e("span",[t._v(t._s(t.$L("\u9879\u76EE\u4EBA\u5458\u53EF\u89C1")))]):t.addData.visibility_appoint==2?e("span",[t._v(t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458\u53EF\u89C1")))]):t._e()]):e("UserSelect",{ref:"visibleUserSelectRef",attrs:{"avatar-size":24,title:t.$L("\u9009\u62E9\u6307\u5B9A\u4EBA\u5458"),"project-id":t.addData.project_id,border:""},on:{"on-show-change":t.visibleUserSelectShowChange},model:{value:t.addData.visibility_appointor,callback:function(s){t.$set(t.addData,"visibility_appointor",s)},expression:"addData.visibility_appointor"}})],1),e("div",{staticClass:"subtasks"},[t.addData.subtasks.length>0?e("div",{staticClass:"sublist"},[e("Row",[e("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u63CF\u8FF0")))]),e("Col",{attrs:{span:"8"}},[t._v(t._s(t.$L("\u8BA1\u5212\u65F6\u95F4")))]),e("Col",{attrs:{span:"4"}},[t._v(t._s(t.$L("\u8D1F\u8D23\u4EBA")))])],1),t._l(t.addData.subtasks,function(s,i){return e("Row",{key:i},[e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{maxlength:255,clearable:""},on:{"on-clear":function(o){return t.addData.subtasks.splice(i,1)}},model:{value:s.name,callback:function(o){t.$set(s,"name",o)},expression:"item.name"}})],1),e("Col",{attrs:{span:"8"}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u65F6\u95F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(o){return t.taskTimeChange(s.times)}},model:{value:s.times,callback:function(o){t.$set(s,"times",o)},expression:"item.times"}})],1),e("Col",{attrs:{span:"4"}},[e("UserSelect",{attrs:{"multiple-max":1,title:t.$L("\u9009\u62E9\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:s.owner,callback:function(o){t.$set(s,"owner",o)},expression:"item.owner"}})],1)],1)})],2):t._e(),e("Input",{class:["enter-input",t.subName==""?"empty":""],attrs:{type:"text",placeholder:t.$L("+ \u8F93\u5165\u5B50\u4EFB\u52A1\uFF0C\u56DE\u8F66\u6DFB\u52A0\u5B50\u4EFB\u52A1")},on:{"on-enter":t.addSubTask},model:{value:t.subName,callback:function(s){t.subName=s},expression:"subName"}})],1)],1):t._e(),e("div",{staticClass:"ivu-modal-footer"},[e("div",{staticClass:"adaption"},[e("Button",{attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("ButtonGroup",{staticClass:"page-manage-add-task-button-group"},[e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAdd}},[t._v(t._s(t.$L("\u6DFB\u52A0\u4EFB\u52A1")))]),e("Dropdown",{attrs:{transfer:""},on:{"on-click":function(s){return t.onAdd(!0)}}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{disabled:t.loadIng>0}},[t._v(t._s(t.$L("\u63D0\u4EA4\u7EE7\u7EED\u6DFB\u52A0")))])],1)],1)],1)],1)])],1)},mt=[];const ft={name:"TaskAdd",components:{UserSelect:v,TEditor:W},props:{value:{type:Boolean,default:!1}},data(){return{addData:{cascader:[],name:"",content:"",owner:[],add_assist:1,project_id:0,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:"",visibility_appoint:1,visibility_appointor:[]},cascaderShow:!1,cascaderData:[],cascaderValue:"",cascaderLoading:0,cascaderAlready:[],advanced:!1,subName:"",taskPlugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace visualblocks visualchars code","insertdatetime media nonbreaking save table directionality","emoticons paste codesample","autoresize"],taskOptions:{statusbar:!1,menubar:!1,autoresize_bottom_margin:2,min_height:200,max_height:380,contextmenu:"bold italic underline forecolor backcolor | codesample | uploadImages imagePreview | preview screenload",valid_elements:"a[href|target=_blank],em,strong/b,div[align],span[style],a,br,p,img[src|alt|witdh|height],pre[class],code",toolbar:!1},taskOptionFull:{menubar:"file edit view",valid_elements:"a[href|target=_blank],em,strong/b,div[align],span[style],a,br,p,img[src|alt|witdh|height],pre[class],code",toolbar:"uploadImages | bold italic underline forecolor backcolor | codesample | preview screenload"},taskTimeOpen:!1,timeOptions:{shortcuts:$A.timeOptionShortcuts()},loadIng:0,isMounted:!1,beforeClose:[]}},async mounted(){this.initCascaderData(),await this.initProjectData(),this.$nextTick(()=>this.$refs.input.focus()),this.isMounted=!0},beforeDestroy(){this.beforeClose.some(t=>{typeof t=="function"&&t()}),this.beforeClose=[]},computed:{...d(["cacheProjects","projectId","cacheColumns","taskPriority"]),taskDays(){const{times:t}=this.addData;let a=$A.date2string(t,"Y-m-d H:i");if(a[0]&&a[1]){let e=Math.ceil(($A.Date(a[1],!0)-$A.Date(a[0],!0))/86400);if(e>0)return e}return 0},showAddAssist(){return!this.addData.owner.includes(this.userId)}},watch:{"addData.project_id"(t){t>0&&$A.IDBSave("cacheAddTaskProjectId",t)},"addData.column_id"(t){t>0&&$A.IDBSave("cacheAddTaskColumnId",t);const{project_id:a}=this.addData;a&&t?this.$set(this.addData,"cascader",[a,t]):this.$set(this.addData,"cascader",[])}},methods:{initCascaderData(){const t=$A.cloneJSON(this.cacheProjects).sort((a,e)=>a.top_at||e.top_at?$A.Date(e.top_at)-$A.Date(a.top_at):e.id-a.id);this.cascaderData=t.map(a=>{const e=this.cacheColumns.filter(({project_id:i})=>i==a.id).map(i=>({value:i.id,label:i.name})),s={value:a.id,label:a.name,children:e};return e.length==0&&(s.loading=!1),s})},async initProjectData(){let t=await $A.IDBInt("cacheAddTaskProjectId"),a=this.cacheProjects.find(({id:e})=>e==this.projectId)||this.cacheProjects.find(({id:e})=>e==t)||this.cacheProjects.find(({id:e})=>e>0);if(a){let e=await $A.IDBInt("cacheAddTaskColumnId"),s=this.cacheColumns.find(({project_id:i,id:o})=>i==a.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==a.id);s?(this.addData.project_id=s.project_id,this.addData.column_id=s.id):this.$store.dispatch("getColumns",a.id).then(()=>{s=this.cacheColumns.find(({project_id:i,id:o})=>i==a.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==a.id),s&&(this.addData.project_id=s.project_id,this.addData.column_id=s.id)}).catch(()=>{})}this.taskPriority.length>0&&this.choosePriority(this.taskPriority[0])},taskTimeChange(t){let a=$A.date2string(t,"Y-m-d H:i");a[0]&&a[1]&&$A.rightExists(a[0],"00:00")&&$A.rightExists(a[1],"00:00")&&this.$set(this.addData,"times",[a[0],a[1].replace("00:00","23:59")])},taskTimeOpenChange(t){this.taskTimeOpen=t},onKeydown(t){if(t.keyCode===13){if(t.shiftKey)return;t.preventDefault(),this.onAdd()}},addSubTask(){this.subName.trim()!==""&&(this.addData.subtasks.push({name:this.subName.trim(),owner:[this.userId],times:[]}),this.subName="")},taskPriorityContent(t){let a=$A.runNum(t.days);return a<=0?t.name+" ("+this.$L("\u65E0\u65F6\u95F4\u9650\u5236")+")":t.name+" ("+a+this.$L("\u5929")+")"},choosePriority(t){let a=new Date,e=$A.runNum(t.days);if(e>0){let s=new Date(new Date().setDate(a.getDate()+e));this.$set(this.addData,"times",$A.date2string([a,s]))}else this.$set(this.addData,"times",[]);this.$set(this.addData,"p_level",t.priority),this.$set(this.addData,"p_name",t.name),this.$set(this.addData,"p_color",t.color)},cascaderLoadData(t,a){t.loading=!0,this.$store.dispatch("getColumns",t.value).then(e=>{t.children=e.map(s=>({value:s.id,label:s.name})),t.loading=!1,a()}).catch(()=>{t.loading=!1,a()})},cascaderChange(t){t[1]&&(this.$set(this.addData,"project_id",t[0]),this.$set(this.addData,"column_id",t[1]))},cascaderInputChange(t){this.cascaderValue=t||"",this.cascaderAlready[this.cascaderValue]!==!0&&(this.cascaderAlready[this.cascaderValue]=!0,setTimeout(()=>{this.cascaderLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.cascaderValue},getcolumn:"yes"}).then(()=>{this.cascaderLoading--,this.initCascaderData()}).catch(()=>{this.cascaderLoading--}))},setData(t){if(!this.isMounted){this.__setData&&clearTimeout(this.__setData),this.__setData=setTimeout(a=>this.setData(t),10);return}typeof t.beforeClose!="undefined"&&(this.beforeClose.push(t.beforeClose),delete t.beforeClose),this.addData=Object.assign({},this.addData,t)},onAdd(t){if(!this.addData.name){$A.messageError("\u4EFB\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");return}this.loadIng++,this.$store.dispatch("taskAdd",this.addData).then(({msg:a})=>{this.loadIng--,$A.messageSuccess(a),t===!0?(this.addData=Object.assign({},this.addData,{name:"",content:"",subtasks:[]}),this.$refs.input.focus()):(this.addData={cascader:[],name:"",content:"",owner:[],add_assist:1,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:""},this.close())}).catch(({msg:a})=>{this.loadIng--,$A.modalError(a)})},close(){this.$emit("input",!this.value)},showCisibleDropdown(){this.$refs.eDropdownRef.show()},visibleUserSelectShowChange(t){if(!t&&(this.addData.visibility_appointor.length==0||!this.addData.visibility_appointor[0])){let a=this.addData.old_visibility_appoint;this.addData.visibility_appoint=a>2?1:a||1,this.addData.visibility_appoint<3}},dropVisible(t){switch(t){case 1:case 2:this.addData.visibility_appoint=t;break;case 3:this.addData.old_visibility_appoint=this.addData.visibility_appoint,this.addData.visibility_appoint=t,this.$nextTick(()=>{this.$refs.visibleUserSelectRef.onSelection()});break}}}},D={};var gt=r(ft,pt,mt,!1,vt,null,null,null);function vt(t){for(let a in D)this[a]=D[a]}var _t=function(){return gt.exports}(),$t=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"report-list-wrap"},[e("div",{staticClass:"search-expand"},[e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(s){t.$set(t.keys,"type",s)},expression:"keys.type"}},t._l(t.reportTypeList,function(s){return e("Option",{key:s.value,attrs:{value:s.value}},[t._v(t._s(s.label))])}),1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u65F6\u95F4"))+" ")]),e("div",{staticClass:"search-content"},[e("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.keys.created_at,callback:function(s){t.$set(t.keys,"created_at",s)},expression:"keys.created_at"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"expand-button-group"},[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.addReport}},[t._v(t._s(t.$L("\u65B0\u589E\u62A5\u544A")))])],1)]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""}}),e("Page",{attrs:{total:t.listTotal,current:t.listPage,"page-size":t.listPageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},bt=[];const kt={name:"ReportMy",data(){return{loadIng:0,columns:[{title:this.$L("\u540D\u79F0"),key:"title",minWidth:180,render:(t,{row:a})=>t("AutoTip",a.title)},{title:this.$L("\u7C7B\u578B"),key:"type",align:"center",width:90},{title:this.$L("\u6C47\u62A5\u65F6\u95F4"),key:"created_at",align:"center",width:180},{title:this.$L("\u6C47\u62A5\u5BF9\u8C61"),key:"receives",align:"center",width:90,render:(t,{row:a})=>{if(a.receives.length===0)return t("div","-");const e=[];return a.receives.length<=2?a.receives.some(s=>{e.push(t("UserAvatar",{props:{size:22,userid:s}}))}):(e.push(t("UserAvatar",{props:{size:22,userid:a.receives[0]}})),e.push(t("div",{class:"more-avatar"},`+${a.receives.length-1}`))),t("div",{class:"report-table-avatar"},e)}},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,minWidth:100,render:(t,{column:a,row:e})=>e.id?t("TableAction",{props:{column:a,menu:[{icon:"md-create",action:"edit"},{icon:"md-eye",action:"view"}]},on:{action:s=>{s==="edit"?this.$emit("on-edit",e.id):s==="view"&&this.$emit("on-view",e)}}}):null}],lists:[],listPage:1,listTotal:0,listPageSize:20,noDataText:"\u6570\u636E\u52A0\u8F7D\u4E2D.....",keys:{},keyIs:!1,reportTypeList:[{value:"",label:this.$L("\u5168\u90E8")},{value:"weekly",label:this.$L("\u5468\u62A5")},{value:"daily",label:this.$L("\u65E5\u62A5")}]}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.listPage=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"report/my",data:{keys:this.keys,page:Math.max(this.listPage,1),pagesize:Math.max($A.runNum(this.listPageSize),10)}}).then(({data:t})=>{this.lists=t.data,this.listTotal=t.total,this.noDataText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(({msg:t})=>{$A.messageError(t),this.noDataText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(()=>{this.loadIng--})},setPage(t){this.listPage=t,this.getLists()},setPageSize(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},addReport(){this.$emit("on-edit",0)}}},L={};var yt=r(kt,$t,bt,!1,wt,null,null,null);function wt(t){for(let a in L)this[a]=L[a]}var Dt=function(){return yt.exports}(),Lt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"report-list-wrap"},[e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u5173\u952E\u8BCD"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{placeholder:t.$L("\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22"),clearable:""},model:{value:t.keys.key,callback:function(s){t.$set(t.keys,"key",s)},expression:"keys.key"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(s){t.$set(t.keys,"type",s)},expression:"keys.type"}},t._l(t.reportTypeList,function(s){return e("Option",{key:s.value,attrs:{value:s.value}},[t._v(t._s(s.label))])}),1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u6C47\u62A5\u65F6\u95F4"))+" ")]),e("div",{staticClass:"search-content"},[e("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.keys.created_at,callback:function(s){t.$set(t.keys,"created_at",s)},expression:"keys.created_at"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(s){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""},on:{"on-selection-change":t.selectChange}}),e("div",{staticClass:"table-attach"},[e("div",{staticClass:"select-box"},[e("Select",{attrs:{disabled:t.selectIds.length==0,placeholder:t.$L("\u8BF7\u9009\u62E9"),transfer:""},on:{"on-change":function(s){t.groupSelect=!0}},model:{value:t.selectAction,callback:function(s){t.selectAction=s},expression:"selectAction"}},[e("Option",{attrs:{value:"read"}},[t._v(t._s(t.$L("\u6807\u8BB0\u5DF2\u8BFB")))]),e("Option",{attrs:{value:"unread"}},[t._v(t._s(t.$L("\u6807\u8BB0\u672A\u8BFB")))])],1),e("Button",{attrs:{loading:t.loadIng>0,type:"primary",disabled:t.selectAction==""||t.selectIds.length==0},on:{click:t.selectClick}},[t._v(t._s(t.$L("\u6267\u884C")))])],1),e("Page",{attrs:{total:t.listTotal,current:t.listPage,"page-size":t.listPageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)],1)])},Ct=[];const xt={name:"ReportReceive",data(){return{loadIng:0,columns:[{type:"selection",width:50,align:"right"},{title:this.$L("\u6807\u9898"),key:"title",sortable:!0,minWidth:180,render:(t,{row:a})=>{let e=[];const s=a.receives_user.find(({userid:i})=>i==this.userId);return s&&s.pivot.read==0?e.push(t("Tag",{props:{color:"orange"},style:{flexShrink:0}},this.$L("\u672A\u8BFB")),t("AutoTip",a.title)):e.push(t("AutoTip",a.title)),t("div",{style:{display:"flex",alignItems:"center"}},e)}},{title:this.$L("\u7C7B\u578B"),key:"type",sortable:!0,width:90},{title:this.$L("\u63A5\u6536\u65F6\u95F4"),key:"receive_time",align:"center",sortable:!0,width:180},{title:this.$L("\u64CD\u4F5C"),align:"center",width:90,minWidth:90,render:(t,{column:a,row:e})=>e.id?t("TableAction",{props:{column:a,menu:[{icon:"md-eye",action:"view"}]},on:{action:s=>{if(s==="view"){this.$emit("on-view",e);const i=e.receives_user.find(({userid:o})=>o==this.userId);i&&this.$set(i.pivot,"read",1)}}}}):null}],lists:[],listPage:1,listTotal:0,listPageSize:20,noDataText:"\u6570\u636E\u52A0\u8F7D\u4E2D.....",keys:{},keyIs:!1,selectIds:[],selectAction:"",reportTypeList:[{value:"",label:this.$L("\u5168\u90E8")},{value:"weekly",label:this.$L("\u5468\u62A5")},{value:"daily",label:this.$L("\u65E5\u62A5")}]}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.listPage=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"report/receive",data:{keys:this.keys,page:Math.max(this.listPage,1),pagesize:Math.max($A.runNum(this.listPageSize),10)}}).then(({data:t})=>{this.lists=t.data,this.listTotal=t.total,this.noDataText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(({msg:t})=>{$A.messageError(t),this.noDataText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(()=>{this.loadIng--})},setPage(t){this.listPage=t,this.getLists()},setPageSize(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},selectChange(t){this.selectIds=t.map(({id:a})=>a)},selectClick(){if(this.selectIds.length===0){$A.messageWarning("\u8BF7\u9009\u62E9\u7EBF\u8DEF");return}switch(this.selectAction){case"read":case"unread":this.readReport(this.selectIds,this.selectAction);break;default:$A.messageWarning("\u8BF7\u9009\u62E9\u6267\u884C\u65B9\u5F0F");break}},readReport(t,a){const e=a==="read"?"\u6807\u8BB0\u5DF2\u8BFB":"\u6807\u8BB0\u672A\u8BFB";$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u8981\u3010${e}\u3011\u5417\uFF1F`,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A",loading:!0,onOk:()=>new Promise((s,i)=>{this.$store.dispatch("call",{url:"report/mark",data:{id:t,action:a}}).then(({msg:o})=>{s(o),this.getLists(),this.$emit("on-read")}).catch(({msg:o})=>{i(o)})})})}}},C={};var Tt=r(xt,Lt,Ct,!1,St,null,null,null);function St(t){for(let a in C)this[a]=C[a]}var It=function(){return Tt.exports}(),At=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"report"},[e("Tabs",{model:{value:t.reportTabs,callback:function(s){t.reportTabs=s},expression:"reportTabs"}},[e("TabPane",{attrs:{label:t.$L("\u6211\u7684\u6C47\u62A5"),name:"my"}},[t.reportTabs==="my"?e("ReportMy",{ref:"report",on:{"on-view":t.onView,"on-edit":t.onEditReport}}):t._e()],1),e("TabPane",{attrs:{label:t.tabRebder(t.reportUnreadNumber),name:"receive"}},[t.reportTabs==="receive"?e("ReportReceive",{on:{"on-view":t.onView,"on-read":t.onRead}}):t._e()],1)],1),e("DrawerOverlay",{attrs:{placement:"right",size:950,transfer:""},model:{value:t.showDetailDrawer,callback:function(s){t.showDetailDrawer=s},expression:"showDetailDrawer"}},[t.showDetailDrawer?e("ReportDetail",{attrs:{data:t.detailData}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1e3,transfer:""},model:{value:t.showEditDrawer,callback:function(s){t.showEditDrawer=s},expression:"showEditDrawer"}},[t.showEditDrawer?e("ReportEdit",{attrs:{id:t.reportId},on:{saveSuccess:t.saveSuccess}}):t._e()],1)],1)},Mt=[];const jt={name:"Report",components:{DrawerOverlay:B,ReportEdit:H,ReportMy:Dt,ReportReceive:It,ReportDetail:V},props:{value:{default:"my"}},data(){return{reportTabs:"my",showDetailDrawer:!1,showEditDrawer:!1,detailData:{},reportId:0}},mounted(){this.reportTabs=this.value,this.$isMainElectron&&this.$Electron.listenerOnly("reportSaveSuccess",({data:t,msg:a})=>{$A.messageSuccess(a),this.saveSuccess(t)})},computed:{...d(["reportUnreadNumber"])},watch:{reportTabs(t){this.$emit("input",t)}},methods:{tabRebder(t){return a=>t>0?a("div",[a("span",{class:"navbar-item-content"},this.$L("\u6536\u5230\u7684\u6C47\u62A5")),a("Badge",{class:"manage-box-report",props:{count:t}})]):a("div",[a("span",{class:"navbar-item-content"},this.$L("\u6536\u5230\u7684\u6C47\u62A5"))])},onView(t){if(this.detailData=t,this.$emit("on-read"),this.$Electron){let a={title:t.title,titleFixed:!0,parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)};this.$Electron.sendMessage("windowRouter",{name:`report-detail-${t.id}`,path:`/single/report/detail/${t.id}`,force:!1,config:a})}else this.showDetailDrawer=!0},onRead(){this.$emit("on-read",0)},onEditReport(t){if(this.$Electron){let a={title:this.$L(t>0?"\u4FEE\u6539\u62A5\u544A":"\u65B0\u589E\u62A5\u544A"),parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)};this.$Electron.sendMessage("windowRouter",{name:`report-edit-${t}`,path:`/single/report/edit/${t}`,force:!1,config:a})}else this.reportId=t,this.showEditDrawer=!0},saveSuccess(){this.reportId=0,this.reportTabs="my",this.showEditDrawer=!1,this.$refs.report&&this.$refs.report.getLists()}}},x={};var Pt=r(jt,At,Mt,!1,Ut,null,null,null);function Ut(t){for(let a in x)this[a]=x[a]}var Rt=function(){return Pt.exports}(),Et=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mobile-back"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.windowScrollY>0,expression:"windowScrollY > 0"}],ref:"bar",staticClass:"back-bar"}),t.show?e("div",{staticClass:"back-semicircle",style:t.style}):t._e()])},Bt=[];const Nt={name:"MobileBack",props:{showTabbar:{type:Boolean,default:!1}},data(){return{show:!1,x:0,y:0}},created(){this.appAndroidEvents()},mounted(){this.$refs.bar.addEventListener("touchmove",this.barListener),document.addEventListener("touchstart",this.touchstart),document.addEventListener("touchmove",this.touchmove),document.addEventListener("touchend",this.touchend)},beforeDestroy(){this.$refs.bar.removeEventListener("touchmove",this.barListener),document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)},computed:{...d(["fileLists","messengerSearchKey"]),style(){const a=Math.max(135,this.y)+this.windowScrollY,e=this.windowHeight-135;return{top:Math.min(a,e)+"px",left:this.x>20?0:"-50px"}},routeName(){return this.$route.name},fileFolderId(){const{folderId:t}=this.$route.params;return parseInt(/^\d+$/.test(t)?t:0)}},watch:{show(t){t?document.body.classList.add("touch-back"):document.body.classList.remove("touch-back"),this.$store.state.touchBackInProgress=t}},methods:{getXY(t){let a=t.touches[0];this.x=a.clientX,this.y=a.clientY},barListener(t){t.preventDefault()},touchstart(t){this.getXY(t),this.show=this.canBack()&&this.x<20},touchmove(t){this.show&&this.getXY(t)},touchend(){this.x>90&&this.show&&this.onBack(),this.x=0,this.show=!1},canBack(){if(!this.showTabbar||this.$Modal.visibles().length>0||this.fileFolderId>0)return!0;if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts)return!0}else if(this.messengerSearchKey.dialog)return!0}return!1},onBack(){if(!this.$Modal.removeLast()){if(this.fileFolderId>0){const t=this.fileLists.find(({id:a,permission:e})=>a==this.fileFolderId&&e>-1);if(t){const a=this.fileLists.find(({id:e,permission:s})=>e==t.pid&&s>-1);if(a){this.goForward({name:"manage-file",params:{folderId:a.id,fileId:null}});return}}this.goForward({name:"manage-file"});return}if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts){this.$store.state.messengerSearchKey.contacts="";return}}else if(this.messengerSearchKey.dialog){this.$store.state.messengerSearchKey.dialog="";return}}this.goBack()}},appAndroidEvents(){this.$isEEUiApp&&$A.isAndroid()&&$A.eeuiAppSetPageBackPressed({pageName:"firstPage"},t=>{this.canBack()?this.onBack():$A.eeuiAppGoDesktop()})}}},T={};var Ot=r(Nt,Et,Bt,!1,zt,null,null,null);function zt(t){for(let a in T)this[a]=T[a]}var Ft=function(){return Ot.exports}(),Wt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.show&&t.userid>0?e("transition",{attrs:{name:"mobile-notify"}},[e("div",{staticClass:"mobile-notification",class:{show:t.show},on:{click:function(s){return s.stopPropagation(),t.onClick.apply(null,arguments)},touchstart:t.onTouchstart,touchmove:t.onTouchmove}},[e("UserAvatar",{attrs:{userid:t.userid,size:40,"show-name":"","name-text":t.title}}),e("div",{staticClass:"notification-desc"},[t._v(t._s(t.desc))])],1)]):t._e()},Ht=[];const Vt={name:"MobileNotification",data(){return{userid:0,title:"",desc:"",duration:6e3,callback:null,show:!1,timer:null,startY:0}},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.show=!1},methods:{open(t){!$A.isJson(t)||(this.userid=t.userid||0,this.title=t.title||"",this.desc=t.desc||"",this.duration=typeof t.duration=="number"?t.duration:6e3,this.callback=typeof t.callback=="function"?t.callback:null,this.show=!0,this.timer&&clearTimeout(this.timer),this.duration>0&&(this.timer=setTimeout(this.close,this.duration)),$A.eeuiAppSendMessage({action:"setVibrate"}))},close(){this.show=!1},onClick(){this.close(),typeof this.callback=="function"&&this.callback()},onTouchstart(t){this.startY=t.touches[0].clientY},onTouchmove(t){this.startY>0&&this.startY-t.touches[0].clientY>10&&(this.startY=0,this.close())}}},S={};var Kt=r(Vt,Wt,Ht,!1,Yt,null,null,null);function Yt(t){for(let a in S)this[a]=S[a]}var Jt=function(){return Kt.exports}(),qt=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.userid?e("div",{staticClass:"meeting-player"},[e("div",{staticClass:"player",style:t.playerStyle,attrs:{id:t.id}}),e("UserAvatar",{attrs:{userid:t.userid,size:36,borderWitdh:2}}),e("div",{staticClass:"player-state"},[t.audio?t._e():e("i",{staticClass:"taskfont"},[t._v("\uE7C7")]),t.video?t._e():e("i",{staticClass:"taskfont"},[t._v("\uE7C8")])])],1):t._e()},Gt=[];const Xt={name:"MeetingPlayer",props:{id:{type:String,default:()=>"meeting-player-"+Math.round(Math.random()*1e4)},player:{type:Object,default:()=>({})},isLocal:{type:Boolean,default:!1}},data(){return{timer:null}},mounted(){this.timer=setInterval(t=>{this.audio&&!this.player.audioTrack.isPlaying&&this.play("audio"),this.video&&!this.player.videoTrack.isPlaying&&this.play("video")},3e3)},beforeDestroy(){clearInterval(this.timer)},computed:{...d(["cacheUserBasic"]),userid(){return this.player.uid?parseInt($A.getMiddle(this.player.uid,null,"-")):0},playerStyle(){const t=this.cacheUserBasic.find(({userid:a})=>a==this.userid);return t?{backgroundImage:`url("${t.userimg}")`}:null},audio(){return!!this.player.audioTrack},video(){return!!this.player.videoTrack}},watch:{audio:{handler(t){t&&this.play("audio")},immediate:!0},video:{handler(t){t&&this.play("video")},immediate:!0}},methods:{play(t){this.$nextTick(a=>{try{t==="audio"?!this.isLocal&&this.player.audioTrack.play():t==="video"&&this.player.videoTrack.play(this.id)}catch(e){console.log("Meeting Player Error",e)}})}}},I={};var Qt=r(Xt,qt,Gt,!1,Zt,null,null,null);function Zt(t){for(let a in I)this[a]=I[a]}var te=function(){return Qt.exports}(),ee=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{ref:"floatDrag",style:t.dragStyle,on:{mousedown:function(s){return s.stopPropagation(),s.preventDefault(),t.mouseDown.apply(null,arguments)}}},[t._t("default")],2)},ae=[];const se={name:"DragBallComponent",props:{id:{type:String,default:""},distanceRight:{type:Number,default:0},distanceBottom:{type:Number,default:100},isScrollHidden:{type:Boolean,default:!1},isCanDraggable:{type:Boolean,default:!0},zIndex:{type:Number,default:50}},data(){return{clientWidth:null,clientHeight:null,top:0,left:0,timer:null,currentTop:0,isMoving:!1,record:{}}},created(){this.clientWidth=document.documentElement.clientWidth,this.clientHeight=document.documentElement.clientHeight},mounted(){this.id&&($A.isJson(window._DragBallComponent)||(window._DragBallComponent={})),this.isCanDraggable&&this.$nextTick(()=>{this.id&&$A.isJson(window._DragBallComponent[this.id])?(this.left=window._DragBallComponent[this.id].left,this.top=window._DragBallComponent[this.id].top):(this.left=this.clientWidth-this.floatDrag.offsetWidth-this.distanceRight,this.top=this.clientHeight-this.floatDrag.offsetHeight-this.distanceBottom),this.initDraggable()}),this.isScrollHidden&&window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize)},beforeDestroy(){this.id&&(window._DragBallComponent[this.id]={left:this.left,top:this.top}),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)},computed:{dragStyle(){return{left:this.left+"px",top:this.top+"px",zIndex:this.zIndex,position:"fixed"}},floatDrag(){return this.$refs.floatDrag}},methods:{handleScroll(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.handleScrollEnd()},200),this.currentTop=document.documentElement.scrollTop||document.body.scrollTop,this.left>this.clientWidth/2?this.left=this.clientWidth+this.floatDrag.offsetWidth:this.left=-this.floatDrag.offsetWidth},handleScrollEnd(){(document.documentElement.scrollTop||document.body.scrollTop)===this.currentTop&&(this.left>this.clientWidth/2?this.left=this.clientWidth-this.floatDrag.offsetWidth:this.left=0,clearTimeout(this.timer))},handleResize(){this.clientWidth=document.documentElement.clientWidth,this.clientHeight=document.documentElement.clientHeight,this.$nextTick(this.checkDraggablePosition)},initDraggable(){this.floatDrag.addEventListener("touchstart",this.toucheStart),this.floatDrag.addEventListener("touchmove",this.touchMove),this.floatDrag.addEventListener("touchend",this.touchEnd)},mouseDown(t){this.record={time:new Date().getTime(),top:this.floatDrag.offsetTop,left:this.floatDrag.offsetLeft,x:t.clientX-this.floatDrag.offsetLeft,y:t.clientY-this.floatDrag.offsetTop},this.floatDrag.style.transition="none",this.canClick=!1,document.onmousemove=a=>{let e=a.clientX-this.record.x,s=a.clientY-this.record.y;e<0?e=0:e>window.innerWidth-this.floatDrag.offsetWidth&&(e=window.innerWidth-this.floatDrag.offsetWidth),s<0?s=0:s>window.innerHeight-this.floatDrag.offsetHeight&&(s=window.innerHeight-this.floatDrag.offsetHeight),this.left=e,this.top=s},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,this.checkDraggablePosition(),this.floatDrag.style.transition="all 0.3s",(Math.abs(this.record.top-this.floatDrag.offsetTop)<5&&Math.abs(this.record.left-this.floatDrag.offsetLeft)<5||new Date().getTime()-this.record.time<200)&&this.$emit("on-click")}},toucheStart(){this.canClick=!1,this.floatDrag.style.transition="none"},touchMove(t){if(this.canClick=!0,t.targetTouches.length===1){let a=event.targetTouches[0],e=a.clientX-this.floatDrag.offsetWidth/2,s=a.clientY-this.floatDrag.offsetHeight/2;e<0?e=0:e>window.innerWidth-this.floatDrag.offsetWidth&&(e=window.innerWidth-this.floatDrag.offsetWidth),s<0?s=0:s>window.innerHeight-this.floatDrag.offsetHeight&&(s=window.innerHeight-this.floatDrag.offsetHeight),this.left=e,this.top=s}},touchEnd(){!this.canClick||(this.floatDrag.style.transition="all 0.3s",this.checkDraggablePosition())},checkDraggablePosition(){this.left+this.floatDrag.offsetWidth/2>=this.clientWidth/2?this.left=this.clientWidth-this.floatDrag.offsetWidth:this.left=0,this.top<0&&(this.top=0),this.top+this.floatDrag.offsetHeight>=this.clientHeight&&(this.top=this.clientHeight-this.floatDrag.offsetHeight)}}},A={};var ie=r(se,ee,ae,!1,oe,null,null,null);function oe(t){for(let a in A)this[a]=A[a]}var re=function(){return ie.exports}(),ne=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"meeting-warp"},[e("Modal",{attrs:{title:t.$L(t.addData.type==="join"?"\u52A0\u5165\u4F1A\u8BAE":"\u65B0\u4F1A\u8BAE"),"mask-closable":!1},model:{value:t.addShow,callback:function(s){t.addShow=s},expression:"addShow"}},[e("Form",{ref:"addForm",attrs:{model:t.addData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[t.addData.type==="join"?[t.addData.name?e("FormItem",{attrs:{prop:"userids",label:t.$L("\u4F1A\u8BAE\u4E3B\u9898")}},[e("Input",{attrs:{disabled:""},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1):t._e(),e("FormItem",{attrs:{prop:"meetingid",label:t.$L("\u4F1A\u8BAE\u9891\u9053ID")}},[e("Input",{attrs:{disabled:t.addData.meetingdisabled===!0,placeholder:t.$L("\u8BF7\u8F93\u5165\u4F1A\u8BAE\u9891\u9053ID")},model:{value:t.addData.meetingid,callback:function(s){t.$set(t.addData,"meetingid",s)},expression:"addData.meetingid"}})],1)]:[e("FormItem",{attrs:{prop:"name",label:t.$L("\u4F1A\u8BAE\u4E3B\u9898")}},[e("Input",{attrs:{maxlength:50,placeholder:t.$L("\u9009\u586B")},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1),e("FormItem",{attrs:{prop:"userids",label:t.$L("\u9080\u8BF7\u6210\u5458")}},[e("UserSelect",{attrs:{uncancelable:[t.userId],"multiple-max":20,title:t.$L("\u9009\u62E9\u9080\u8BF7\u6210\u5458")},model:{value:t.addData.userids,callback:function(s){t.$set(t.addData,"userids",s)},expression:"addData.userids"}})],1)],e("FormItem",{attrs:{prop:"tracks"}},[e("CheckboxGroup",{model:{value:t.addData.tracks,callback:function(s){t.$set(t.addData,"tracks",s)},expression:"addData.tracks"}},[e("Checkbox",{attrs:{label:"audio"}},[e("span",[t._v(t._s(t.$L("\u9EA6\u514B\u98CE")))])]),e("Checkbox",{attrs:{label:"video"}},[e("span",[t._v(t._s(t.$L("\u6444\u50CF\u5934")))])])],1)],1)],2),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.addShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onSubmit}},[t._v(t._s(t.$L(t.addData.type==="join"?"\u52A0\u5165\u4F1A\u8BAE":"\u5F00\u59CB\u4F1A\u8BAE")))])],1)],1),e("Modal",{ref:"meetingModal",attrs:{title:t.addData.name,mask:!1,"mask-closable":!1,closable:!1,"transition-names":["",""],beforeClose:t.onClose,"class-name":`meeting-manager${t.meetingMini?" meeting-hidden":""}`,fullscreen:""},model:{value:t.meetingShow,callback:function(s){t.meetingShow=s},expression:"meetingShow"}},[e("ul",[t.localUser.uid?e("li",[e("MeetingPlayer",{attrs:{player:t.localUser,isLocal:""}})],1):t._e(),t._l(t.remoteUsers,function(s){return e("li",[e("MeetingPlayer",{attrs:{player:s}})],1)})],2),e("div",{staticClass:"adaption meeting-button-group",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"primary",loading:t.audioLoad},on:{click:t.onAudio}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(t.localUser.audioTrack?"&#xe7c3;":"&#xe7c7;")}})]),e("Button",{attrs:{type:"primary",loading:t.videoLoad},on:{click:t.onVideo}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(t.localUser.videoTrack?"&#xe7c1;":"&#xe7c8;")}})]),t.windowPortrait?[e("Button",{attrs:{type:"primary"},on:{click:function(s){return t.onInvitation("open")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE646")])]),e("Button",{attrs:{type:"primary"},on:{click:function(s){t.meetingMini=!0}}},[e("i",{staticClass:"taskfont"},[t._v("\uE656")])]),e("Button",{attrs:{type:"warning",loading:t.loadIng>0},on:{click:t.onClose}},[e("i",{staticClass:"taskfont"},[t._v("\uE612")])])]:[e("Button",{attrs:{type:"primary"},on:{click:function(s){return t.onInvitation("open")}}},[t._v(t._s(t.$L("\u9080\u8BF7")))]),e("Button",{attrs:{type:"primary"},on:{click:function(s){t.meetingMini=!0}}},[t._v(t._s(t.$L("\u6700\u5C0F\u5316")))]),e("Button",{attrs:{type:"warning",loading:t.loadIng>0},on:{click:t.onClose}},[t._v(t._s(t.$L("\u79BB\u5F00\u4F1A\u8BAE")))])]],2)]),t.meetingMini?e("DragBallComponent",{attrs:{id:"meetingDragBall","z-index":3e3},on:{"on-click":function(s){t.meetingMini=!1}}},[e("div",{staticClass:"meeting-drag-ball"},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(t.localUser.audioTrack?"&#xe7c3;":"&#xe7c7;")}}),e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(t.localUser.videoTrack?"&#xe7c1;":"&#xe7c8;")}}),e("em",[t._v(t._s(t.$L("\u4F1A\u8BAE\u4E2D")))])])]):t._e(),e("Modal",{attrs:{title:t.$L("\u9080\u8BF7\u52A0\u5165"),"mask-closable":!1},model:{value:t.invitationShow,callback:function(s){t.invitationShow=s},expression:"invitationShow"}},[e("Form",{ref:"invitationForm",attrs:{model:t.invitationData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{prop:"userids",label:t.$L("\u9080\u8BF7\u6210\u5458")}},[e("UserSelect",{attrs:{"multiple-max":20,title:t.$L("\u9009\u62E9\u9080\u8BF7\u6210\u5458")},model:{value:t.invitationData.userids,callback:function(s){t.$set(t.invitationData,"userids",s)},expression:"invitationData.userids"}})],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.invitationShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.invitationLoad},on:{click:function(s){return t.onInvitation("submit")}}},[t._v(t._s(t.$L("\u53D1\u9001\u9080\u8BF7")))])],1)],1)],1)},le=[];const ce={name:"MeetingManager",components:{UserSelect:v,DragBallComponent:re,MeetingPlayer:te},data(){return{loadIng:0,subscribe:null,addShow:!1,addData:{userids:[],tracks:["audio"]},invitationShow:!1,invitationLoad:!1,invitationData:{userids:[]},meetingShow:!1,meetingMini:!1,audioLoad:!1,videoLoad:!1,agoraClient:null,remoteUsers:[],localUser:{uid:null,audioTrack:null,videoTrack:null}}},mounted(){this.subscribe=c.Store.subscribe("addMeeting",this.onAdd)},beforeDestroy(){this.subscribe&&(this.subscribe.unsubscribe(),this.subscribe=null)},watch:{meetingShow(t){t?$A.eeuiAppKeepScreenOn():$A.eeuiAppKeepScreenOff()},meetingMini(t){t||(this.$refs.meetingModal.modalIndex=this.$refs.meetingModal.handleGetModalIndex())}},methods:{onAdd(t){t=$A.isJson(t)?t:{},/^\d+$/.test(t.dialog_id)&&(this.loadIng++,this.$store.dispatch("call",{url:"dialog/user",data:{dialog_id:t.dialog_id}}).then(({data:a})=>{this.$set(this.addData,"userids",a.map(e=>e.userid))}).finally(a=>{this.loadIng--}),delete t.dialog_id),$A.isArray(t.userids)?t.userids.includes(this.userId)||t.userids.push(this.userId):t.userids=[this.userId],$A.isArray(t.tracks)?t.tracks.includes("audio")||t.tracks.push("audio"):t.tracks=["audio"],this.addData=t,this.addShow=!0},onSubmit(){if(this.meetingShow){$A.modalWarning("\u6B63\u5728\u4F1A\u8BAE\u4E2D\uFF0C\u65E0\u6CD5\u8FDB\u5165\u5176\u4ED6\u4F1A\u8BAE\u5BA4");return}this.$refs.addForm.validate(t=>{t&&(this.loadIng++,this.$store.dispatch("call",{url:"users/meeting/open",data:this.addData}).then(({data:a})=>{this.$set(this.addData,"name",a.name),this.$set(this.addData,"meetingid",a.meetingid),this.$store.dispatch("saveDialogMsg",a.msgs),this.$store.dispatch("updateDialogLastMsg",a.msgs),delete a.name,delete a.msgs,$A.loadScript("js/AgoraRTC_N-4.17.0.js").then(e=>{this.join(a)}).catch(e=>{$A.modalError("\u4F1A\u8BAE\u7EC4\u4EF6\u52A0\u8F7D\u5931\u8D25\uFF01")}).finally(e=>{this.loadIng--})}).catch(({msg:a})=>{this.loadIng--,$A.modalError(a)}))})},onAudio(){this.localUser.audioTrack?this.closeAudio():this.openAudio()},onVideo(){this.localUser.videoTrack?this.closeVideo():this.openVideo()},onInvitation(t){t==="open"?(this.invitationData={userids:[],meetingid:this.addData.meetingid},this.invitationShow=!0):t==="submit"&&(this.invitationLoad=!0,this.$store.dispatch("call",{url:"users/meeting/invitation",data:this.invitationData}).then(({data:a,msg:e})=>{this.invitationShow=!1,this.$store.dispatch("saveDialogMsg",a.msgs),this.$store.dispatch("updateDialogLastMsg",a.msgs),$A.messageSuccess(e)}).catch(({msg:a})=>{$A.modalError(a)}).finally(a=>{this.invitationLoad=!1}))},onClose(){return new Promise(t=>{$A.modalConfirm({content:"\u786E\u5B9A\u8981\u79BB\u5F00\u4F1A\u8BAE\u5417\uFF1F",cancelText:"\u7EE7\u7EED",okText:"\u9000\u51FA",onOk:async a=>{await this.leave(),t()}})})},async join(t){this.loadIng++,AgoraRTC.onMicrophoneChanged=async e=>{if(e.state==="ACTIVE")this.localUser.audioTrack.setDevice(e.device.deviceId);else if(e.device.label===this.localUser.audioTrack.getTrackLabel()){const s=await AgoraRTC.getMicrophones();s[0]&&this.localUser.audioTrack.setDevice(s[0].deviceId)}},AgoraRTC.onCameraChanged=async e=>{if(e.state==="ACTIVE")this.localUser.videoTrack.setDevice(e.device.deviceId);else if(e.device.label===this.localUser.videoTrack.getTrackLabel()){const s=await AgoraRTC.getCameras();s[0]&&this.localUser.videoTrack.setDevice(s[0].deviceId)}},AgoraRTC.onAutoplayFailed=()=>{$A.messageWarning("\u70B9\u51FB\u5C4F\u5E55\u5F00\u59CB\u4F1A\u8BAE")},this.agoraClient=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),this.agoraClient.on("user-joined",this.handleUserJoined),this.agoraClient.on("user-left",this.handleUserLeft),this.agoraClient.on("user-published",this.handleUserPublished),this.agoraClient.on("user-unpublished",this.handleUserUnpublished);const a=[];this.localUser.uid=await this.agoraClient.join(t.appid,t.channel,t.token,t.uid),this.addData.tracks.includes("audio")&&a.push(this.localUser.audioTrack=await AgoraRTC.createMicrophoneAudioTrack()),this.addData.tracks.includes("video")&&a.push(this.localUser.videoTrack=await AgoraRTC.createCameraVideoTrack()),a.length>0&&await this.agoraClient.publish(a),this.loadIng--,this.addShow=!1,this.meetingShow=!0},async leave(){this.loadIng++,["audioTrack","videoTrack"].some(t=>{var a,e;(a=this.localUser[t])==null||a.stop(),(e=this.localUser[t])==null||e.close()}),this.localUser={uid:null,audioTrack:null,videoTrack:null},this.remoteUsers=[],await this.agoraClient.leave(),this.loadIng--,this.meetingShow=!1},async openAudio(){this.audioLoad||this.localUser.audioTrack||(this.audioLoad=!0,this.localUser.audioTrack=await AgoraRTC.createMicrophoneAudioTrack(),await this.agoraClient.publish([this.localUser.audioTrack]),this.audioLoad=!1)},async closeAudio(){this.audioLoad||!this.localUser.audioTrack||(this.audioLoad=!0,await this.agoraClient.unpublish([this.localUser.audioTrack]),this.localUser.audioTrack.stop(),this.localUser.audioTrack.close(),this.localUser.audioTrack=null,this.audioLoad=!1)},async openVideo(){this.videoLoad||this.localUser.videoTrack||(this.videoLoad=!0,this.localUser.videoTrack=await AgoraRTC.createCameraVideoTrack(),await this.agoraClient.publish([this.localUser.videoTrack]),this.videoLoad=!1)},async closeVideo(){this.videoLoad||!this.localUser.videoTrack||(this.videoLoad=!0,await this.agoraClient.unpublish([this.localUser.videoTrack]),this.localUser.videoTrack.stop(),this.localUser.videoTrack.close(),this.localUser.videoTrack=null,this.videoLoad=!1)},async handleUserJoined(t){const a=this.remoteUsers.findIndex(e=>e.uid==t.uid);a>-1?this.remoteUsers.splice(a,1,t):this.remoteUsers.push(t)},async handleUserLeft(t){const a=this.remoteUsers.findIndex(e=>e.uid==t.uid);a>-1&&this.remoteUsers.splice(a,1)},async handleUserPublished(t,a){this.remoteUsers.find(s=>s.uid==t.uid)&&await this.agoraClient.subscribe(t,a)},async handleUserUnpublished(t,a){this.remoteUsers.find(s=>s.uid==t.uid)&&await this.agoraClient.unsubscribe(t,a)}}},M={};var de=r(ce,ne,le,!1,he,null,null,null);function he(t){for(let a in M)this[a]=M[a]}var ue=function(){return de.exports}(),pe=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{value:t.visible,mask:!1,"mask-closable":!1,"footer-hide":!0,"transition-names":["mobile-dialog",""],beforeClose:t.onBeforeClose,"class-name":"dialog-modal",fullscreen:""}},[t.windowPortrait&&t.dialogId>0?e("DialogWrapper",{attrs:{dialogId:t.dialogId,beforeBack:t.onBeforeClose}}):t._e()],1)},me=[];const fe={name:"DialogModal",components:{DialogWrapper:Y},data(){return{timer:null}},computed:{...d(["dialogId"]),visible(){return this.dialogId>0&&this.windowPortrait}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openDialog",0)})}}},j={};var ge=r(fe,pe,me,!1,ve,null,null,null);function ve(t){for(let a in j)this[a]=j[a]}var _e=function(){return ge.exports}(),$e=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{value:t.show,styles:t.styles,"mask-closable":!1,"footer-hide":!0,beforeClose:t.onBeforeClose,"class-name":"task-modal"}},[e("TaskDetail",{ref:"taskDetail",attrs:{"task-id":t.taskId,"open-task":t.taskData,modalMode:""}})],1)},be=[];const ke={name:"TaskModal",components:{TaskDetail:J},computed:{...d(["taskId"]),...g(["taskData"]),show(){return this.taskId>0},styles(){return{width:"90%",maxWidth:this.taskData.dialog_id?"1200px":"700px"}}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openTask",0)})},checkUpdate(){if(this.show)return this.$refs.taskDetail.checkUpdate(!0),!0}}},P={};var ye=r(ke,$e,be,!1,we,null,null,null);function we(t){for(let a in P)this[a]=P[a]}var De=function(){return ye.exports}(),Le=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1"),"mask-closable":!1},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("Form",{ref:"exportTask",attrs:{model:t.formData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u5BFC\u51FA\u6210\u5458")}},[e("UserSelect",{attrs:{"multiple-max":100,"avatar-name":"","show-disable":"",title:t.$L("\u8BF7\u9009\u62E9\u6210\u5458")},model:{value:t.formData.userid,callback:function(s){t.$set(t.formData,"userid",s)},expression:"formData.userid"}}),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6BCF\u6B21\u6700\u591A\u9009\u62E9\u5BFC\u51FA100\u4E2A\u6210\u5458")))])],1),e("FormItem",{attrs:{label:t.$L("\u65F6\u95F4\u8303\u56F4")}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.formData.time,callback:function(s){t.$set(t.formData,"time",s)},expression:"formData.time"}}),e("div",{staticClass:"form-tip checkin-export-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(s){t.formData.time=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),e("em",{on:{click:function(s){t.formData.time=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),e("FormItem",{attrs:{prop:"type",label:t.$L("\u5BFC\u51FA\u65F6\u95F4\u7C7B\u578B")}},[e("RadioGroup",{model:{value:t.formData.type,callback:function(s){t.$set(t.formData,"type",s)},expression:"formData.type"}},[e("Radio",{attrs:{label:"taskTime"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u65F6\u95F4")))]),e("Radio",{attrs:{label:"createdTime"}},[t._v(t._s(t.$L("\u521B\u5EFA\u65F6\u95F4")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},Ce=[];const xe={name:"TaskExport",components:{UserSelect:v},props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{userid:[],time:[],type:"taskTime"}}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},methods:{dateShortcuts(t){if(t==="prev")return[$A.getSpecifyDate("\u4E0A\u4E2A\u6708"),$A.getSpecifyDate("\u4E0A\u4E2A\u6708\u7ED3\u675F")];if(t==="this")return[$A.getSpecifyDate("\u672C\u6708"),$A.getSpecifyDate("\u672C\u6708\u7ED3\u675F")]},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"project/task/export",data:this.formData}).then(({data:t})=>{this.show=!1,this.$store.dispatch("downUrl",{url:t.url})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},U={};var Te=r(xe,Le,Ce,!1,Se,null,null,null);function Se(t){for(let a in U)this[a]=U[a]}var Ie=function(){return Te.exports}(),Ae=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u5BA1\u6279\u6570\u636E"),"mask-closable":!1},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("Form",{ref:"exportTask",attrs:{model:t.formData,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{label:t.$L("\u5BA1\u6279\u7C7B\u578B")}},[e("Select",{on:{"on-open-change":t.getProcName},model:{value:t.formData.proc_def_name,callback:function(s){t.$set(t.formData,"proc_def_name",s)},expression:"formData.proc_def_name"}},t._l(t.procList,function(s,i){return e("Option",{key:i,attrs:{value:s.name}},[t._v(t._s(s.name))])}),1)],1),e("FormItem",{attrs:{label:t.$L("\u65F6\u95F4\u8303\u56F4")}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.formData.date,callback:function(s){t.$set(t.formData,"date",s)},expression:"formData.date"}}),e("div",{staticClass:"form-tip checkin-export-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(s){t.formData.date=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),e("em",{on:{click:function(s){t.formData.date=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),e("FormItem",{attrs:{prop:"type",label:t.$L("\u5BFC\u51FA\u7C7B\u578B")}},[e("RadioGroup",{model:{value:t.formData.is_finished,callback:function(s){t.$set(t.formData,"is_finished",s)},expression:"formData.is_finished"}},[e("Radio",{attrs:{label:"0"}},[t._v(t._s(t.$L("\u672A\u5B8C\u6210")))]),e("Radio",{attrs:{label:"1"}},[t._v(t._s(t.$L("\u5DF2\u5B8C\u6210")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},Me=[];const je={name:"ApproveExport",props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{proc_def_name:"",date:[],is_finished:"1"},procList:[]}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},methods:{dateShortcuts(t){if(t==="prev")return[$A.getSpecifyDate("\u4E0A\u4E2A\u6708"),$A.getSpecifyDate("\u4E0A\u4E2A\u6708\u7ED3\u675F")];if(t==="this")return[$A.getSpecifyDate("\u672C\u6708"),$A.getSpecifyDate("\u672C\u6708\u7ED3\u675F")]},getProcName(){this.loadIng++,this.$store.dispatch("call",{url:"approve/procdef/all",method:"post"}).then(({data:t})=>{this.procList=t.rows}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--})},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"approve/export",data:this.formData}).then(({data:t})=>{this.show=!1,this.$store.dispatch("downUrl",{url:t.url})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},R={};var Pe=r(je,Ae,Me,!1,Ue,null,null,null);function Ue(t){for(let a in R)this[a]=R[a]}var Re=function(){return Pe.exports}();const Ee=(t,a)=>!t||!a?!1:t==="String"?typeof a=="string":t==="Object"?Object.prototype.toString.call(a)==="[object Object]":t==="number"?typeof a=="number":t==="function"?Object.prototype.toString.call(a)==="[object Function]":!1,Be=(t,a,e)=>t.findIndex(s=>s[a]===e);var l={checkData:Ee,searchArrObj:Be};class Ne{constructor(a="\u9ED8\u8BA4\u6807\u9898",e={}){this.title=a,this.options=e,this.support=!1,this.supportFn()}supportFn(){window.Notification?(this.initStatus(),this.support=!0):this.support=!1}initStatus(){this.notification=null,this.state=Notification.permission,this.msg=null,this.callBackObj={},this.notificationAll=[],this.requireInteractionTimeout=!1,this.timeout=null}initNotification(a){if(!!this.checkStatus("support")){if(!l.checkData("function",a))return console.error("initNotification\u7684\u53C2\u6570\u5FC5\u987B\u4E3A\u51FD\u6570");if(this.state==="granted")this.msg="already granted";else if(this.state==="default"){const e=s=>(this.state=s,s==="granted"?this.msg="granted":s==="default"?this.msg="close":this.msg="denied",a(this.msg));try{Notification.requestPermission().then(e)}catch{Notification.requestPermission(e)}}else this.msg="already denied";if(this.state!=="default")return a(this.msg)}}userAgreed(){if(!!this.checkStatus("userAgreed")){this.notification=new Notification(this.title,this.options),this.notificationWatch();for(const a in this.callBackObj)this.notification[a]=e=>{this.callBackObj[a](e)}}}notificationTimeoutFn(a){a&&l.checkData("number",a)?this.timeout=a:this.timeout=5e3}notificationWatch(){this.notificationAll.push(this.notification),this.notification.requireInteraction?this.everyTimeout():this.autoClose(),this.watchClose()}everyTimeout(){!l.checkData("number",this.timeout)||(this.options.timeOut&&l.checkData("number",this.options.timeOut)?this.timeoutCloseFn(this.options.timeOut):this.timeoutCloseFn(this.timeout))}timeoutCloseFn(a){const e=this.notification.timestamp;setTimeout(()=>{const s=l.searchArrObj(this.notificationAll,"timestamp",e);s!==-1&&this.notificationAll[s].close()},a)}watchClose(){const a=this.notification.timestamp;this.notification.addEventListener("close",e=>{const s=l.searchArrObj(this.notificationAll,"timestamp",a);s!==-1&&this.notificationAll.splice(s,1)})}autoClose(){const a=this.notification.timestamp;setTimeout(()=>{const e=l.searchArrObj(this.notificationAll,"timestamp",a);e!==-1&&this.notificationAll.splice(e,1)},6e3)}notificationEvent(a){if(!!this.checkStatus("support"))if(l.checkData("Object",a)){for(const e in a)if(!l.checkData("function",a[e]))return console.error("callObj\u5BF9\u8C61\u4E2D\u7684\u6BCF\u4E2Avalue\u5FC5\u987B\u4E3A\u51FD\u6570");this.callBackObj=a}else return console.error("callObj\u5FC5\u987B\u4E3A\u5BF9\u8C61")}closeAll(){for(let a of this.notificationAll.values())a.close();this.notificationAll=[]}close(){if(!this.notification)return console.warn("this.notification\u4E3Anull,\u901A\u77E5\u5C1A\u672A\u8C03\u7528/\u7528\u6237\u672A\u540C\u610F\u663E\u793A\u901A\u77E5");this.notification.close()}updateOptions(a){if(a&&l.checkData("Object",a))for(const e in a)this.options[e]=a[e];else console.warn("updateOptions\u53C2\u6570\u9519\u8BEF\uFF1Aoptions\u4E3A\u5FC5\u586B\u5BF9\u8C61")}replaceTitle(a){a&&l.checkData("String",a)?this.title=a:console.warn("replaceTitle: title(\u901A\u77E5\u6807\u9898)\u4E3A\u5FC5\u586B\u5B57\u7B26\u4E32")}replaceOptions(a){a&&l.checkData("Object",a)?this.options=a:console.warn("replaceOptions\u53C2\u6570\u9519\u8BEF\uFF1Aoptions\u4E3A\u5FC5\u586B\u5BF9\u8C61")}checkStatus(a){if(a==="support"){if(!this.support)return console.warn("\u7528\u6237\u6D4F\u89C8\u5668\u4E0D\u652F\u6301"),!1}else if(a==="userAgreed"&&(this.state!=="granted"||!this.checkStatus("support")))return!1;return!0}}var Oe=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.userId>0,expression:"userId > 0"}],staticClass:"page-manage",class:{"show-tabbar":t.showMobileTabbar}},[e("div",{staticClass:"manage-box-menu",class:{"show-mobile-menu":t.showMobileMenu}},[e("Dropdown",{staticClass:"page-manage-menu-dropdown main-menu",attrs:{trigger:"click"},on:{"on-click":t.settingRoute,"on-visible-change":t.menuVisibleChange}},[e("div",{class:["manage-box-title",t.visibleMenu?"menu-visible":""]},[e("div",{staticClass:"manage-box-avatar"},[e("UserAvatar",{attrs:{userid:t.userId,size:36,tooltipDisabled:""}})],1),e("span",[t._v(t._s(t.userInfo.nickname))]),t.reportUnreadNumber+t.approveUnreadNumber>0?e("Badge",{staticClass:"manage-box-top-report",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}}):t.clientNewVersion?e("Badge",{staticClass:"manage-box-top-report",attrs:{dot:""}}):t._e(),e("div",{staticClass:"manage-box-arrow"},[e("Icon",{attrs:{type:"ios-arrow-up"}}),e("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t._l(t.menu,function(s){return[s.path==="taskBrowse"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!s.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t.taskBrowseLists.length>0?e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.taskBrowseLists,function(i,o){return i.id>0&&o<10?e("DropdownItem",{key:o,staticClass:"task-title",attrs:{name:i.name},nativeOn:{click:function(h){return t.openTask(i)}}},[i.flow_item_name?e("span",{class:i.flow_item_status},[t._v(t._s(i.flow_item_name))]):t._e(),e("div",{staticClass:"task-title-text"},[t._v(t._s(i.name))])]):t._e()}),1):e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{staticStyle:{color:"darkgrey"}},[t._v(t._s(t.$L("\u6682\u65E0\u6253\u5F00\u8BB0\u5F55")))])],1)],1):s.path==="team"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!s.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),t.reportUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber}}):e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"allUser"}},[t._v(t._s(t.$L("\u56E2\u961F\u7BA1\u7406")))]),e("DropdownItem",{attrs:{name:"workReport"}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L("\u5DE5\u4F5C\u62A5\u544A"))+" "),t.reportUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber}}):t._e()],1)]),e("DropdownItem",{attrs:{name:"exportTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1")))]),e("DropdownItem",{attrs:{name:"exportOverdueTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u8D85\u671F\u4EFB\u52A1")))]),e("DropdownItem",{attrs:{name:"exportApprove"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u5BA1\u6279\u6570\u636E")))]),e("DropdownItem",{attrs:{name:"exportCheckin"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u7B7E\u5230\u6570\u636E")))])],1)],1):s.visible!==!1?e("DropdownItem",{style:s.style||{},attrs:{divided:!!s.divided,name:s.path}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(s.name))+" "),s.path==="version"?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{text:t.clientNewVersion}}):s.path==="workReport"&&t.reportUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.reportUnreadNumber}}):s.path==="approve"&&t.approveUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.approveUnreadNumber}}):t._e()],1)]):t._e()]})],2)],1),e("Scrollbar",{attrs:{"class-name":"manage-item"},on:{"on-scroll":function(s){t.operateVisible=!1}}},[e("div",{staticClass:"menu-base"},[e("ul",[e("li",{class:t.classNameRoute("dashboard"),on:{click:function(s){return t.toggleRoute("dashboard")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6FB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u4EEA\u8868\u76D8")))]),t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.all_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.all_count}}):t._e()],1),e("li",{class:t.classNameRoute("calendar"),on:{click:function(s){return t.toggleRoute("calendar")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F5")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u65E5\u5386")))])]),e("li",{class:t.classNameRoute("messenger"),on:{click:function(s){return t.toggleRoute("messenger")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6D88\u606F")))]),e("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})],1),e("li",{class:t.classNameRoute("file"),on:{click:function(s){return t.toggleRoute("file")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F3")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6587\u4EF6")))])])])]),e("div",{ref:"menuProject",staticClass:"menu-project"},[e("ul",[t._l(t.projectLists,function(s,i){return e("li",{directives:[{name:"longpress",rawName:"v-longpress",value:t.handleLongpress,expression:"handleLongpress"}],key:i,ref:`project_${s.id}`,refInFor:!0,class:t.classNameProject(s),attrs:{"data-id":s.id},on:{click:function(o){return t.toggleRoute("project",{projectId:s.id})}}},[e("div",{staticClass:"project-h1"},[e("em",{on:{click:function(o){return o.stopPropagation(),t.toggleOpenMenu(s.id)}}}),e("div",{staticClass:"title"},[t._v(t._s(s.name))]),s.top_at?e("div",{staticClass:"icon-top"}):t._e(),s.task_my_num-s.task_my_complete>0?e("div",{staticClass:"num"},[t._v(t._s(s.task_my_num-s.task_my_complete))]):t._e()]),e("div",{staticClass:"project-h2"},[e("p",[e("em",[t._v(t._s(t.$L("\u6211\u7684"))+":")]),e("span",[t._v(t._s(s.task_my_complete)+"/"+t._s(s.task_my_num))]),e("Progress",{attrs:{percent:s.task_my_percent,"stroke-width":6}})],1),e("p",[e("em",[t._v(t._s(t.$L("\u5168\u90E8"))+":")]),e("span",[t._v(t._s(s.task_complete)+"/"+t._s(s.task_num))]),e("Progress",{attrs:{percent:s.task_percent,"stroke-width":6}})],1)])])}),t.projectKeyLoading>0?e("li",{staticClass:"loading"},[e("Loading")],1):t._e()],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.operateVisible,expression:"operateVisible"}],staticClass:"operate-position",style:t.operateStyles},[e("Dropdown",{attrs:{trigger:"custom",placement:t.windowLandscape?"bottom":"top",visible:t.operateVisible,transfer:""},on:{"on-clickoutside":function(s){t.operateVisible=!1}}},[e("div",{style:{userSelect:t.operateVisible?"none":"auto",height:t.operateStyles.height}}),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{nativeOn:{click:function(s){return t.handleTopClick.apply(null,arguments)}}},[t._v(" "+t._s(t.$L(t.operateItem.top_at?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876\u8BE5\u9879\u76EE"))+" ")])],1)],1)],1),(t.projectSearchShow||t.projectTotal>20)&&t.windowHeight>600?e("div",{staticClass:"manage-project-search"},[e("Input",{attrs:{placeholder:t.$L(`\u5171${t.projectTotal||t.cacheProjects.length}\u4E2A\u9879\u76EE\uFF0C\u641C\u7D22...`),clearable:""},model:{value:t.projectKeyValue,callback:function(s){t.projectKeyValue=s},expression:"projectKeyValue"}},[e("div",{staticClass:"search-pre",attrs:{slot:"prefix"},slot:"prefix"},[t.projectKeyLoading>0?e("Loading"):e("Icon",{attrs:{type:"ios-search"}})],1)])],1):t._e(),e("ButtonGroup",{staticClass:"manage-box-new-group"},[e("Button",{staticClass:"manage-box-new",attrs:{type:"primary",icon:"md-add"},on:{click:t.onAddShow}},[t._v(t._s(t.$L("\u65B0\u5EFA\u9879\u76EE")))]),e("Dropdown",{attrs:{trigger:"click"},on:{"on-click":t.onAddMenu}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"task"}},[t._v(t._s(t.$L("\u65B0\u5EFA\u4EFB\u52A1"))+" ("+t._s(t.mateName)+"+K)")]),e("DropdownItem",{attrs:{name:"createMeeting"}},[t._v(t._s(t.$L("\u65B0\u4F1A\u8BAE"))+" ("+t._s(t.mateName)+"+J)")]),e("DropdownItem",{attrs:{name:"joinMeeting"}},[t._v(t._s(t.$L("\u52A0\u5165\u4F1A\u8BAE")))])],1)],1)],1)],1),e("div",{staticClass:"manage-box-main"},[e("keep-alive",[e("router-view",{staticClass:"manage-box-view"})],1)],1),e("Modal",{attrs:{title:t.$L("\u65B0\u5EFA\u9879\u76EE"),"mask-closable":!1},model:{value:t.addShow,callback:function(s){t.addShow=s},expression:"addShow"}},[e("Form",{ref:"addProject",attrs:{model:t.addData,rules:t.addRule,"label-width":"auto"},nativeOn:{submit:function(s){s.preventDefault()}}},[e("FormItem",{attrs:{prop:"name",label:t.$L("\u9879\u76EE\u540D\u79F0")}},[e("Input",{ref:"projectName",attrs:{type:"text"},model:{value:t.addData.name,callback:function(s){t.$set(t.addData,"name",s)},expression:"addData.name"}})],1),t.addData.columns?e("FormItem",{attrs:{label:t.$L("\u4EFB\u52A1\u5217\u8868")}},[e("TagInput",{model:{value:t.addData.columns,callback:function(s){t.$set(t.addData,"columns",s)},expression:"addData.columns"}})],1):e("FormItem",{attrs:{label:t.$L("\u9879\u76EE\u6A21\u677F")}},[e("Select",{attrs:{value:0,placeholder:t.$L("\u8BF7\u9009\u62E9\u6A21\u677F")},on:{"on-change":t.selectChange}},t._l(t.columns,function(s,i){return e("Option",{key:i,attrs:{value:i}},[t._v(t._s(s.name))])}),1)],1),e("FormItem",{attrs:{prop:"flow",label:t.$L("\u5F00\u542F\u5DE5\u4F5C\u6D41")}},[e("RadioGroup",{model:{value:t.addData.flow,callback:function(s){t.$set(t.addData,"flow",s)},expression:"addData.flow"}},[e("Radio",{attrs:{label:"open"}},[t._v(t._s(t.$L("\u5F00\u542F")))]),e("Radio",{attrs:{label:"close"}},[t._v(t._s(t.$L("\u5173\u95ED")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(s){t.addShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAddProject}},[t._v(t._s(t.$L("\u6DFB\u52A0")))])],1)],1),e("Modal",{attrs:{"mask-closable":!1,styles:{width:"90%",maxWidth:"640px"},"footer-hide":""},model:{value:t.addTaskShow,callback:function(s){t.addTaskShow=s},expression:"addTaskShow"}},[e("TaskAdd",{ref:"addTask",model:{value:t.addTaskShow,callback:function(s){t.addTaskShow=s},expression:"addTaskShow"}})],1),e("TaskExport",{model:{value:t.exportTaskShow,callback:function(s){t.exportTaskShow=s},expression:"exportTaskShow"}}),e("CheckinExport",{model:{value:t.exportCheckinShow,callback:function(s){t.exportCheckinShow=s},expression:"exportCheckinShow"}}),e("ApproveExport",{model:{value:t.exportApproveShow,callback:function(s){t.exportApproveShow=s},expression:"exportApproveShow"}}),e("TaskModal",{ref:"taskModal"}),e("DialogModal",{ref:"dialogModal"}),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.workReportShow,callback:function(s){t.workReportShow=s},expression:"workReportShow"}},[t.workReportShow?e("Report",{on:{"on-read":function(s){return t.$store.dispatch("getReportUnread",1e3)}},model:{value:t.reportTabs,callback:function(s){t.reportTabs=s},expression:"reportTabs"}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1380},model:{value:t.allUserShow,callback:function(s){t.allUserShow=s},expression:"allUserShow"}},[t.allUserShow?e("TeamManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.allProjectShow,callback:function(s){t.allProjectShow=s},expression:"allProjectShow"}},[t.allProjectShow?e("ProjectManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.archivedProjectShow,callback:function(s){t.archivedProjectShow=s},expression:"archivedProjectShow"}},[t.archivedProjectShow?e("ProjectArchived"):t._e()],1),e("MeetingManager"),e("transition",{attrs:{name:"mobile-slide"}},[t.showMobileTabbar?e("MobileTabbar",{on:{"on-click":t.onTabbarClick}}):t._e()],1),e("MobileBack",{attrs:{showTabbar:t.showMobileTabbar}}),e("MobileNotification",{ref:"mobileNotification"})],1)},ze=[];const Fe={components:{TaskExport:Ie,CheckinExport:z,ApproveExport:Re,TaskModal:De,DialogModal:_e,MeetingManager:ue,MobileNotification:Jt,MobileBack:Ft,MobileTabbar:ut,TaskAdd:_t,Report:Rt,DrawerOverlay:B,ProjectManagement:rt,TeamManagement:F,ProjectArchived:tt},directives:{longpress:K},data(){return{loadIng:0,mateName:/macintosh|mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl",addShow:!1,addData:{name:"",columns:"",flow:"open"},addRule:{name:[{required:!0,message:this.$L("\u8BF7\u586B\u5199\u9879\u76EE\u540D\u79F0\uFF01"),trigger:"change"},{type:"string",min:2,message:this.$L("\u9879\u76EE\u540D\u79F0\u81F3\u5C112\u4E2A\u5B57\uFF01"),trigger:"change"}]},addTaskShow:!1,addTaskSubscribe:null,exportTaskShow:!1,exportCheckinShow:!1,exportApproveShow:!1,dialogMsgSubscribe:null,projectKeyValue:"",projectKeyLoading:0,projectSearchShow:!1,openMenu:{},visibleMenu:!1,showMobileMenu:!1,workReportShow:!1,allUserShow:!1,allProjectShow:!1,archivedProjectShow:!1,natificationReady:!1,notificationManage:null,reportTabs:"my",operateStyles:{},operateVisible:!1,operateItem:{},needStartHome:!1}},mounted(){this.notificationInit(),this.addTaskSubscribe=c.Store.subscribe("addTask",this.onAddTask),this.dialogMsgSubscribe=c.Store.subscribe("dialogMsgPush",this.addDialogMsg),document.addEventListener("keydown",this.shortcutEvent)},activated(){this.$store.dispatch("getUserInfo").catch(t=>{}),this.$store.dispatch("getTaskPriority").catch(t=>{}),this.$store.dispatch("getReportUnread",0),this.$store.dispatch("getApproveUnread",0),this.$store.dispatch("needHome").then(t=>{this.needStartHome=!0}).catch(t=>{this.needStartHome=!1})},beforeDestroy(){this.addTaskSubscribe&&(this.addTaskSubscribe.unsubscribe(),this.addTaskSubscribe=null),this.dialogMsgSubscribe&&(this.dialogMsgSubscribe.unsubscribe(),this.dialogMsgSubscribe=null),document.removeEventListener("keydown",this.shortcutEvent)},deactivated(){this.addShow=!1},computed:{...d(["userInfo","userIsAdmin","cacheUserBasic","cacheTasks","cacheDialogs","cacheProjects","projectTotal","wsOpenNum","columnTemplate","wsMsg","clientNewVersion","cacheTaskBrowse","dialogIns","reportUnreadNumber","approveUnreadNumber"]),...g(["dashboardTask"]),routeName(){return this.$route.name},msgUnreadMention(){let t=0,a=0;this.cacheDialogs.some(s=>{t+=$A.getDialogUnread(s,!1),a+=$A.getDialogMention(s)}),t>999&&(t="999+"),a>999&&(a="999+");const e=this.msgTodoTotal;return e?a?`@${a}\xB7${e}`:t?`${t}\xB7${e}`:e:t?a?`${t}\xB7@${a}`:String(t):a?`@${a}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(a=>{t+=$A.getDialogNum(a)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((a,e)=>a+(e.todo_num||0),0);return t>0?(t>99?t="99+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},menu(){const{userIsAdmin:t,needStartHome:a}=this,e=[{path:"taskBrowse",name:"\u6700\u8FD1\u6253\u5F00\u7684\u4EFB\u52A1"}];return t?e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"system",name:"\u7CFB\u7EDF\u8BBE\u7F6E"},{path:"license",name:"License Key"},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"allProject",name:"\u6240\u6709\u9879\u76EE",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"},{path:"team",name:"\u56E2\u961F\u7BA1\u7406",divided:!0},{path:"approve",name:"\u5BA1\u6279\u4E2D\u5FC3"}):e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"approve",name:"\u5BA1\u6279\u4E2D\u5FC3"},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"workReport",name:"\u5DE5\u4F5C\u62A5\u544A",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"}),a?e.push({path:"goHome",name:"\u6253\u5F00\u9996\u9875",divided:!0},{path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58"},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}):e.push({path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58",divided:!0},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}),e},columns(){const t=$A.cloneJSON(this.columnTemplate);return t.unshift({name:this.$L("\u7A7A\u767D\u6A21\u677F"),columns:[]}),t},projectLists(){const{projectKeyValue:t,cacheProjects:a}=this,e=$A.cloneJSON(a).sort((s,i)=>s.top_at||i.top_at?$A.Date(i.top_at)-$A.Date(s.top_at):i.id-s.id);return t?e.filter(s=>$A.strExists(`${s.name} ${s.desc}`,t)):e},taskBrowseLists(){const{cacheTasks:t,cacheTaskBrowse:a,userId:e}=this;return a.filter(({userid:s})=>s===e).map(({id:s})=>t.find(i=>i.id===s)||{})},showMobileTabbar(){return this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?!0:["manage-dashboard","manage-calendar","manage-messenger","manage-file","manage-setting"].includes(this.routeName)}},watch:{$route(){this.chackPass()},userInfo(){this.chackPass()},projectKeyValue(t){t!=""&&setTimeout(()=>{this.projectKeyValue==t&&this.searchProject()},600)},wsOpenNum(t){t<=1||this.$store.dispatch("getBasicData",600)},workReportShow(t){t&&this.$store.dispatch("getReportUnread",0)},"cacheProjects.length":{handler(){this.$nextTick(t=>{const a=this.$refs.menuProject,e=$A.last($A.getObject(a,"children.0.children"));if(e){const s=e.getBoundingClientRect(),i=a.getBoundingClientRect();if(s.top>i.top+i.height){this.projectSearchShow=!0;return}}this.projectSearchShow=!1})},immediate:!0},unreadAndOverdue:{handler(t){this.$Electron&&this.$Electron.sendMessage("setDockBadge",t)},immediate:!0},wsMsg:{handler(t){const{type:a,action:e}=t;switch(a){case"report":e=="unreadUpdate"&&this.$store.dispatch("getReportUnread",1e3);break;case"approve":e=="unread"&&this.$store.dispatch("getApproveUnread",1e3);break}},deep:!0}},methods:{chackPass(){this.userInfo.changepass===1&&this.goForward({name:"manage-setting-password"})},async toggleRoute(t,a){this.showMobileMenu=!1;let e={name:"manage-"+t,params:a||{}},s=await $A.IDBInt("fileFolderId");t==="file"&&s>0&&(e.params.folderId=s),this.goForward(e)},toggleOpenMenu(t){this.$set(this.openMenu,t,!this.openMenu[t])},settingRoute(t){switch(t){case"allUser":this.allUserShow=!0;return;case"allProject":this.allProjectShow=!0;return;case"archivedProject":this.archivedProjectShow=!0;return;case"exportTask":this.exportTaskShow=!0;return;case"exportOverdueTask":this.exportOverdueTask();return;case"exportCheckin":this.exportCheckinShow=!0;return;case"exportApprove":this.exportApproveShow=!0;return;case"workReport":this.reportUnreadNumber>0&&(this.reportTabs="receive"),this.workReportShow=!0;return;case"version":c.Store.set("updateNotification",null);return;case"clearCache":$A.IDBSet("clearCache","handle").then(a=>{$A.reloadUrl()});return;case"goHome":this.needStartHome&&this.goForward("index");return;case"approve":this.menu.findIndex(a=>a.path==t)>-1&&this.goForward({name:"manage-approve"});return;case"logout":$A.modalConfirm({title:"\u9000\u51FA\u767B\u5F55",content:"\u4F60\u786E\u5B9A\u8981\u767B\u51FA\u7CFB\u7EDF\uFF1F",onOk:()=>{this.$store.dispatch("logout",!1)}});return}this.menu.findIndex(a=>a.path==t)>-1&&this.toggleRoute("setting-"+t)},exportOverdueTask(){$A.modalConfirm({title:"\u5BFC\u51FA\u4EFB\u52A1",content:"\u4F60\u786E\u5B9A\u8981\u5BFC\u51FA\u6240\u6709\u8D85\u671F\u4EFB\u52A1\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,a)=>{this.$store.dispatch("call",{url:"project/task/exportoverdue"}).then(({data:e})=>{t(),this.$store.dispatch("downUrl",{url:e.url})}).catch(({msg:e})=>{a(e)})})})},menuVisibleChange(t){this.visibleMenu=t},classNameRoute(t){return{active:this.routeName===`manage-${t}`}},classNameProject(t){return{active:this.routeName==="manage-project"&&this.$route.params.projectId==t.id,"open-menu":this.openMenu[t.id]===!0,operate:t.id==this.operateItem.id&&this.operateVisible}},onAddMenu(t){switch(t){case"task":this.onAddTask(0);break;case"createMeeting":c.Store.set("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":c.Store.set("addMeeting",{type:"join"});break}},onAddShow(){this.$store.dispatch("getColumnTemplate").catch(()=>{}),this.addShow=!0,this.$nextTick(()=>{this.$refs.projectName.focus()})},onAddProject(){this.$refs.addProject.validate(t=>{t&&(this.loadIng++,this.$store.dispatch("call",{url:"project/add",data:this.addData}).then(({data:a,msg:e})=>{$A.messageSuccess(e),this.addShow=!1,this.$refs.addProject.resetFields(),this.$store.dispatch("saveProject",a),this.toggleRoute("project",{projectId:a.id})}).catch(({msg:a})=>{$A.modalError(a)}).finally(a=>{this.loadIng--}))})},searchProject(){setTimeout(()=>{this.projectKeyLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.projectKeyValue}}).finally(t=>{this.projectKeyLoading--})},selectChange(t){this.$nextTick(()=>{this.$set(this.addData,"columns",this.columns[t].columns.join(","))})},shortcutEvent(t){(t.metaKey||t.ctrlKey)&&(t.keyCode===74?(t.preventDefault(),this.onAddMenu("createMeeting")):t.keyCode===75||t.keyCode===78?(t.preventDefault(),this.onAddMenu("task")):t.keyCode===83&&this.$refs.taskModal.checkUpdate()&&t.preventDefault())},onAddTask(t){this.addTaskShow=!0,this.$nextTick(a=>{let e={owner:[this.userId]};$A.isJson(t)?e=t:/^[1-9]\d*$/.test(t)&&(e.column_id=t),this.$refs.addTask.setData(e)})},openTask(t){this.$store.dispatch("openTask",t)},addDialogMsg(t){var b;if(!this.natificationReady&&!this.$isEEUiApp||this.windowActive&&t.dialog_id===((b=$A.last(this.dialogIns))==null?void 0:b.dialog_id))return;const{id:a,dialog_id:e,dialog_type:s,type:i,msg:o,userid:h}=t;if(h==this.userId)return;let u;switch(i){case"text":u=$A.getMsgTextPreview(o.text);break;case"file":u="["+this.$L(o.type=="img"?"\u56FE\u7247\u4FE1\u606F":"\u6587\u4EF6\u4FE1\u606F")+"]";break;default:return}this.__notificationId=a;const _=n=>{if(s==="group"){let p=this.cacheUserBasic.find(f=>f.userid==h);p?m(`${n} (${p.nickname})`):this.$store.dispatch("call",{url:"users/basic",data:{userid:[h]},skipAuthError:!0}).then(({data:f})=>{p=f.find(N=>N.userid==h),p&&m(`${n} (${p.nickname})`)}).catch(f=>{m(n)})}else m(n)},m=n=>{this.__notificationId===a&&(this.$isEEUiApp?this.$refs.mobileNotification.open({userid:h,title:n,desc:u,callback:()=>{this.goForward({name:"manage-messenger"}),this.$store.dispatch("openDialog",e)}}):this.$Electron?this.$Electron.sendMessage("openNotification",{icon:$A.originUrl("images/logo.png"),title:n,body:u,data:t,tag:"dialog",hasReply:!0,replyPlaceholder:this.$L("\u56DE\u590D\u6D88\u606F")}):(this.notificationManage.replaceOptions({icon:$A.originUrl("images/logo.png"),body:u,data:t,tag:"dialog"}),this.notificationManage.replaceTitle(n),this.notificationManage.userAgreed()))},$=this.cacheDialogs.find(n=>n.id==e);$?_($.name):this.$store.dispatch("getDialogOne",e).then(({data:n})=>_(n.name)).catch(()=>{})},handleLongpress(t,a){const e=$A.getAttr(a,"data-id"),s=this.projectLists.find(i=>i.id==e);!s||(this.operateVisible=!1,this.operateItem=$A.isJson(s)?s:{},this.$nextTick(()=>{const i=a.getBoundingClientRect(),o=this.$refs.menuProject.getBoundingClientRect();this.operateStyles={left:`${t.clientX-o.left}px`,top:`${i.top+this.windowScrollY}px`,height:i.height+"px"},this.operateVisible=!0}))},handleTopClick(){this.$store.dispatch("call",{url:"project/top",data:{project_id:this.operateItem.id}}).then(({data:t})=>{this.$store.dispatch("saveProject",t),this.$nextTick(()=>{const a=this.$refs.menuProject.querySelector(".active");a&&$A.scrollIntoViewIfNeeded(a)})}).catch(({msg:t})=>{$A.modalError(t)})},onTabbarClick(t){switch(t){case"addTask":this.onAddTask(0);break;case"addProject":this.onAddShow();break;case"allUser":case"workReport":this.settingRoute(t);break}},notificationInit(){this.notificationManage=new Ne(this.$L("\u6253\u5F00\u901A\u77E5\u6210\u529F")),this.notificationManage.support&&(this.notificationManage.notificationEvent({onclick:({target:t})=>{console.log("[Notification] A Click",t),this.notificationManage.close(),this.notificationClick(t),window.focus()}}),this.notificationPermission()),this.$Electron&&(this.$Electron.registerMsgListener("clickNotification",t=>{console.log("[Notification] B Click",t),this.$Electron.sendMessage("mainWindowActive"),this.notificationClick(t)}),this.$Electron.registerMsgListener("replyNotification",t=>{console.log("[Notification] B Reply",t),this.notificationReply(t)}))},notificationPermission(){const t=a=>{switch(a){case"already granted":case"granted":return this.natificationReady=!0;case"close":return this.notificationManage.initNotification(t);case"denied":case"already denied":console.log(a==="denied"?"\u60A8\u521A\u521A\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E":"\u60A8\u66FE\u7EA7\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E");break}};this.notificationManage.initNotification(t)},notificationClick(t){const{tag:a,data:e}=t;if(a=="dialog"){if(!$A.isJson(e))return;this.goForward({name:"manage-messenger"}),this.$nextTick(s=>{this.$store.dispatch("openDialog",e.dialog_id)})}},notificationReply(t){const{tag:a,data:e,reply:s}=t;a=="dialog"&&s&&this.$store.dispatch("call",{url:"dialog/msg/sendtext",data:{dialog_id:e.dialog_id,text:s},method:"post"}).then(({data:i})=>{this.$store.dispatch("saveDialogMsg",i),this.$store.dispatch("increaseTaskMsgNum",i),this.$store.dispatch("increaseMsgReplyNum",i),this.$store.dispatch("updateDialogLastMsg",i)}).catch(({msg:i})=>{$A.modalError(i)})}}},E={};var We=r(Fe,Oe,ze,!1,He,null,null,null);function He(t){for(let a in E)this[a]=E[a]}var oa=function(){return We.exports}();export{oa as default};
